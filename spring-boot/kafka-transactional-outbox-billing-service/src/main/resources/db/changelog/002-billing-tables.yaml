databaseChangeLog:
  - changeSet:
      id: 002-create-billing-tables
      author: evgeny
      changes:
        - sql:
            sql: |
              -- ===== PROCESSED_EVENT (idempotency / inbox) =====
              CREATE TABLE IF NOT EXISTS outbox_billing.processed_event (
                event_id     UUID PRIMARY KEY,
                processed_at TIMESTAMPTZ NOT NULL DEFAULT now()
              );

              -- ===== PAYMENT (business table) =====
              CREATE TABLE IF NOT EXISTS outbox_billing.payment (
                id         UUID PRIMARY KEY,
                event_id   UUID NOT NULL UNIQUE,
                order_id   UUID NOT NULL,
                amount     NUMERIC(19,2) NOT NULL,
                created_at TIMESTAMPTZ NOT NULL DEFAULT now()
              );

              CREATE INDEX IF NOT EXISTS ix_payment_order_id
                ON outbox_billing.payment (order_id);
