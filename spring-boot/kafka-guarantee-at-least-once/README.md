### At-least-once
— это гарантия доставки Kafka “сообщение будет обработано минимум один раз”. Цена за это: возможны повторы (дубликаты).
>Хотя бы один раз — сообщения никогда не теряются, но могут быть доставлены повторно.

### Как это работает (идея)

Ключевой момент: offset коммитится ПОСЛЕ успешной обработки.

+ Если обработали → ACK/commit offset → Kafka считает сообщение “закрытым”.

+ Если упали до ACK → offset не закоммичен → Kafka при перезапуске/ребалансе даст то же сообщение снова.

![img_8.png](img_8.png)

### Где применимо (и почему это нормально)

__At-least-once__ — базовый и самый распространённый режим в проде, когда:

+ потеря сообщений недопустима (заказы, платежи, аудит, уведомления, события домена),
+ ты готов справляться с повторной доставкой.

### Частая формула в проде:

>At-least-once + Idempotent consumer = “эффект exactly-once” на уровне твоей системы

![img_9.png](img_9.png)

![img.png](img.png)

![img_1.png](img_1.png)

![img_2.png](img_2.png)

![img_3.png](img_3.png)

![img_4.png](img_4.png)

![img_5.png](img_5.png)

>Тут был воспроизведен чистый кейс, как есть - доставка хотябы один раз, 
> сообщения не теряются, но могут быть дубликаты

![img_6.png](img_6.png)

![img_7.png](img_7.png)

